<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Login - Sistema de Empregos</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://kit.fontawesome.com/a2e0e6ad4b.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="panel">
        <h1>üîë Login</h1>
        <form id="loginForm">
            <div class="form-group">
                <input type="text" id="loginUsername" placeholder=" " required>
                <label for="loginUsername">Username</label>
                <i class="fa-solid fa-user"></i>
            </div>

            <div class="form-group">
                <input type="password" id="loginPassword" placeholder=" " required>
                <label for="loginPassword">Senha</label>
                <i class="fa-solid fa-lock"></i>
            </div>

            <button type="submit"><i class="fa-solid fa-right-to-bracket"></i> Entrar</button>
        </form>

        <p class="link">N√£o tem conta? <a href="cadastro.html">Cadastre-se</a></p>

        <pre id="responseArea"></pre>
    </div>

    <script src="api.js"></script>
    <script>
        // Redireciona se j√° estiver logado
        if (sessionStorage.getItem('jwtToken')) {
            window.location.href = 'painel.html';
        }

        const responseArea = document.getElementById('responseArea');

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const body = {
                username: loginUsername.value.trim(),
                password: loginPassword.value.trim()
            };

            const data = await apiCall('/login', 'POST', body);
            responseArea.textContent = JSON.stringify(data, null, 2).replace(/\\n/g, '\n');
            responseArea.textContent = JSON.stringify(data, null, 2).replace(/\\n/g, '\n');
            responseArea.style.whiteSpace = 'pre-wrap';
            responseArea.style.wordWrap = 'break-word';

            if (data?.token) {
                const payload = JSON.parse(atob(data.token.split('.')[1]));
                sessionStorage.setItem('jwtToken', data.token);
                sessionStorage.setItem('userId', payload.sub);
                sessionStorage.setItem('username', payload.username);
                window.location.href = 'painel.html';
            } else {
                alert(`‚ö†Ô∏è Erro no login: ${data.message || 'Credenciais inv√°lidas'}`);
            }
        });
    </script>
</body>
</html>
