<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Cadastro - Sistema de Empregos</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <script src="https://kit.fontawesome.com/a2e0e6ad4b.js" crossorigin="anonymous"></script>
</head>
<body>
    <!-- Indicador de Servidor -->
    <div class="server-indicator" onclick="window.location.href='config-server.html'" title="Clique para configurar">
        <span class="status-dot"></span>
        <span id="serverUrl">Carregando...</span>
    </div>

    <div class="panel">
        <h1>üßç Cadastro</h1>
        <form id="registerForm">
            <div class="form-group">
                <input type="text" id="regName" placeholder=" " required>
                <label for="regName">Nome Completo</label>
                <i class="fa-solid fa-id-card"></i>
            </div>

            <div class="form-group">
                <input type="text" id="regUsername" placeholder=" " required>
                <label for="regUsername">Username</label>
                <i class="fa-solid fa-user"></i>
            </div>

            <div class="form-group">
                <input type="password" id="regPassword" placeholder=" " required>
                <label for="regPassword">Senha</label>
                <i class="fa-solid fa-lock"></i>
            </div>

            <div class="form-group">
                <input type="email" id="regEmail" placeholder=" ">
                <label for="regEmail">Email (opcional)</label>
                <i class="fa-solid fa-envelope"></i>
            </div>

            <div class="form-group">
                <input type="text" id="regPhone" placeholder=" ">
                <label for="regPhone">Telefone (opcional)</label>
                <i class="fa-solid fa-phone"></i>
            </div>

            <div class="form-group">
                <textarea id="regExperience" placeholder=" "></textarea>
                <label for="regExperience">Experi√™ncia (opcional)</label>
            </div>

            <div class="form-group">
                <textarea id="regEducation" placeholder=" "></textarea>
                <label for="regEducation">Forma√ß√£o (opcional)</label>
            </div>

            <button type="submit"><i class="fa-solid fa-user-plus"></i> Cadastrar</button>
        </form>

        <p class="link">J√° tem conta? <a href="login.html">Fa√ßa login</a></p>
        <p class="link"><a href="company-register.html">üè¢ Cadastro de Empresa</a></p>
        <p class="link"><a href="config-server.html">‚öôÔ∏è Configurar Servidor</a></p>

        <pre id="responseArea"></pre>
    </div>

    <script src="../assets/js/api.js"></script>
    <script>
        // Atualiza indicador de servidor
        document.getElementById('serverUrl').textContent = getApiBase();

        // Redireciona se j√° estiver logado
        if (sessionStorage.getItem('jwtToken')) {
            window.location.href = 'painel.html';
        }

        const responseArea = document.getElementById('responseArea');

        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const body = {
                name: regName.value.trim(),
                username: regUsername.value.trim(),
                password: regPassword.value.trim(),
                email: regEmail.value.trim() || null,
                phone: regPhone.value.trim() || null,
                experience: regExperience.value.trim() || null,
                education: regEducation.value.trim() || null
            };
            Object.keys(body).forEach(k => body[k] === null && delete body[k]);

            const data = await apiCall('/users', 'POST', body);
            responseArea.textContent = JSON.stringify(data, null, 2).replace(/\\n/g, '\n');

            if (data?.message === 'Created') {
                alert('‚úÖ Usu√°rio cadastrado com sucesso! Agora voc√™ pode fazer login.');
                navigateAfterApiCall('login.html', 500);
            } else if (data?.details) {
                const errors = data.details.map(d => `‚Ä¢ ${d.field}: ${d.error}`).join('\n');
                alert(`‚ö†Ô∏è Erro de valida√ß√£o:\n${errors}`);
            } else {
                alert(`‚ö†Ô∏è Erro no cadastro: ${data.message || 'Falha desconhecida'}`);
            }
        });
    </script>
</body>
</html>
