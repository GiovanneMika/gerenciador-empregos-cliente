<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Painel da Empresa</title>
    <link rel="stylesheet" href="../assets/css/painel.css">
</head>

<body>
    <div class="panel">
        <h2>ğŸ¢ Painel da Empresa</h2>
        <div id="companyInfo" class="user-info"></div>

        <hr>

        <button id="editBtn">âœï¸ Editar Dados</button>
        <button id="deleteBtn" class="danger">ğŸ—‘ï¸ Deletar Empresa</button>
        <button id="logoutBtn" class="secondary">ğŸšª Logout</button>

        <h2>ğŸ“¡ Resposta do Servidor</h2>
        <pre id="responseArea">Aguardando resposta...</pre>
    </div>

    <script src="../assets/js/company-api.js"></script>
    <script>
        const companyInfoDiv = document.getElementById('companyInfo');
        const responseArea = document.getElementById('responseArea');

        document.addEventListener('DOMContentLoaded', async () => {
            const token = sessionStorage.getItem('companyToken');
            const companyId = sessionStorage.getItem('companyId');

            if (!token || !companyId || !isTokenValid()) {
                alert('âŒ SessÃ£o invÃ¡lida. Redirecionando para login...');
                window.location.href = 'company-login.html';
                return;
            }

            // Busca dados da empresa
            const data = await companyApiCall(`/companies/${companyId}`, 'GET');
            responseArea.innerText = JSON.stringify(data, null, 2);

            if (data.status === 200 && data.name) {
                companyInfoDiv.innerHTML = `
                    <p><strong>Nome:</strong> ${data.name}</p>
                    <p><strong>Ramo:</strong> ${data.business}</p>
                    <p><strong>Username:</strong> ${data.username}</p>
                    <p><strong>Email:</strong> ${data.email}</p>
                    <p><strong>Telefone:</strong> ${data.phone}</p>
                    <p><strong>EndereÃ§o:</strong> ${data.street}, ${data.number} - ${data.city}/${data.state}</p>
                `;
            } else if (data.status === 401) {
                alert('âŒ Token invÃ¡lido. Redirecionando para login...');
                sessionStorage.clear();
                window.location.href = 'company-login.html';
            } else if (data.status === 404) {
                alert('âŒ Empresa nÃ£o encontrada.');
                sessionStorage.clear();
                window.location.href = 'company-login.html';
            } else {
                alert(`âŒ Erro ao carregar dados: ${data.message || 'Erro desconhecido'}`);
            }
        });

        document.getElementById('editBtn').addEventListener('click', () => {
            window.location.href = 'company-edit.html';
        });

        document.getElementById('logoutBtn').addEventListener('click', async () => {
            const data = await companyLogout();
            responseArea.innerText = JSON.stringify(data, null, 2);
            
            alert('âœ… Logout realizado com sucesso.');
            window.location.href = 'company-login.html';
        });

        document.getElementById('deleteBtn').addEventListener('click', async () => {
            if (confirm('âŒ ATENÃ‡ÃƒO: Tem certeza que deseja deletar sua empresa?\n\nEsta aÃ§Ã£o Ã© IRREVERSÃVEL e todos os dados serÃ£o perdidos!')) {
                const companyId = sessionStorage.getItem('companyId');
                const data = await companyApiCall(`/companies/${companyId}`, 'DELETE');
                responseArea.innerText = JSON.stringify(data, null, 2);

                if (data.status === 200) {
                    alert('âœ… Empresa deletada com sucesso.');
                    sessionStorage.clear();
                    window.location.href = 'company-login.html';
                } else if (data.status === 409) {
                    alert('âŒ NÃ£o Ã© possÃ­vel deletar a empresa: ela possui vagas ativas.');
                } else {
                    alert(`âŒ Erro ao deletar empresa: ${data.message || 'Erro desconhecido'}`);
                }
            }
        });
    </script>
</body>

</html>